<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å‰ç«¯è·¨åŸŸçš„é‚£äº›äº‹ | FreddyZhuoå­¦ä¹ ç¬”è®°</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="å­¦ä¹ ç¬”è®°">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.cb0b7186.css" as="style"><link rel="preload" href="/assets/js/app.fa555702.js" as="script"><link rel="preload" href="/assets/js/2.ddebb9ce.js" as="script"><link rel="preload" href="/assets/js/17.075b656b.js" as="script"><link rel="prefetch" href="/assets/js/10.142c2360.js"><link rel="prefetch" href="/assets/js/11.48f12a97.js"><link rel="prefetch" href="/assets/js/12.8a1ea1e9.js"><link rel="prefetch" href="/assets/js/13.4073a192.js"><link rel="prefetch" href="/assets/js/14.85ef0a00.js"><link rel="prefetch" href="/assets/js/15.bd7f9936.js"><link rel="prefetch" href="/assets/js/16.13bde61e.js"><link rel="prefetch" href="/assets/js/18.1f7457ec.js"><link rel="prefetch" href="/assets/js/19.eb7798c1.js"><link rel="prefetch" href="/assets/js/20.ab1ec997.js"><link rel="prefetch" href="/assets/js/21.afd88b1a.js"><link rel="prefetch" href="/assets/js/22.83082d88.js"><link rel="prefetch" href="/assets/js/23.2319cd64.js"><link rel="prefetch" href="/assets/js/24.26225443.js"><link rel="prefetch" href="/assets/js/25.b1a2224b.js"><link rel="prefetch" href="/assets/js/26.a04431a8.js"><link rel="prefetch" href="/assets/js/27.abbc2270.js"><link rel="prefetch" href="/assets/js/28.372a6088.js"><link rel="prefetch" href="/assets/js/29.944a80bc.js"><link rel="prefetch" href="/assets/js/3.513a6ecd.js"><link rel="prefetch" href="/assets/js/30.a2f8b607.js"><link rel="prefetch" href="/assets/js/31.c7f9292f.js"><link rel="prefetch" href="/assets/js/32.a956df01.js"><link rel="prefetch" href="/assets/js/33.76e07a31.js"><link rel="prefetch" href="/assets/js/34.7f7da37b.js"><link rel="prefetch" href="/assets/js/35.10e21a69.js"><link rel="prefetch" href="/assets/js/36.00343348.js"><link rel="prefetch" href="/assets/js/37.91446f0b.js"><link rel="prefetch" href="/assets/js/38.d5f48ff8.js"><link rel="prefetch" href="/assets/js/39.4e2a1e75.js"><link rel="prefetch" href="/assets/js/4.100842c5.js"><link rel="prefetch" href="/assets/js/40.4fbe3063.js"><link rel="prefetch" href="/assets/js/41.1bdf467d.js"><link rel="prefetch" href="/assets/js/42.124d1d61.js"><link rel="prefetch" href="/assets/js/43.7a7ad2a2.js"><link rel="prefetch" href="/assets/js/5.f9676b1f.js"><link rel="prefetch" href="/assets/js/6.b1533a7f.js"><link rel="prefetch" href="/assets/js/7.9539eb4b.js"><link rel="prefetch" href="/assets/js/8.596f2543.js"><link rel="prefetch" href="/assets/js/9.d29a5ade.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cb0b7186.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">FreddyZhuoå­¦ä¹ ç¬”è®°</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  åšå®¢
</a></div><div class="nav-item"><a href="https://github.com/hongxinzz/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  åšå®¢
</a></div><div class="nav-item"><a href="https://github.com/hongxinzz/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/javascript/AOGO.html" class="sidebar-link">JavaScripté¢„ç¼–è¯‘AOã€GO</a></li><li><a href="/blog/javascript/ä½œç”¨åŸŸ.html" class="sidebar-link">JavaScriptå˜é‡ã€ä½œç”¨åŸŸ</a></li><li><a href="/blog/javascript/åŸå‹é“¾.html" class="sidebar-link">åŸå‹é“¾</a></li><li><a href="/blog/javascript/JSç±»å‹.html" class="sidebar-link">åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹</a></li><li><a href="/blog/javascript/Promise.html" class="sidebar-link">Promise</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>æ‰‹å†™ä»£ç </span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/write/Jsonp.html" class="sidebar-link">æ‰‹å†™ä¸€ä¸ªjsonp</a></li><li><a href="/blog/write/é˜²æŠ–èŠ‚æµ.html" class="sidebar-link">é˜²æŠ–å’ŒèŠ‚æµ</a></li><li><a href="/blog/write/æŸ¯é‡ŒåŒ–.html" class="sidebar-link">curry</a></li><li><a href="/blog/write/å®ç°new.html" class="sidebar-link">newå…³é”®å­—</a></li><li><a href="/blog/write/æ·±æ‹·è´.html" class="sidebar-link">æ·±æ‹·è´</a></li><li><a href="/blog/write/promiseAll.html" class="sidebar-link">promise.all</a></li><li><a href="/blog/write/promiseOnce.html" class="sidebar-link">promise.once</a></li><li><a href="/blog/write/promiseå¹¶å‘.html" class="sidebar-link">promiseå¹¶å‘è¯·æ±‚</a></li><li><a href="/blog/write/å®ç°vueè·¯ç”±.html" class="sidebar-link">vueRouter</a></li><li><a href="/blog/write/defineProperty.html" class="sidebar-link">vue2.0å“åº”å¼</a></li><li><a href="/blog/write/å•ä¾‹æ¨¡å¼.html" class="sidebar-link">å•ä¾‹æ¨¡å¼</a></li><li><a href="/blog/write/å‘å¸ƒè®¢é˜….html" class="sidebar-link">å‘å¸ƒè®¢é˜…</a></li><li><a href="/blog/write/max-long-chart.html" class="sidebar-link">å¯»æ‰¾é‡å¤æœ€å¤šçš„å­—ç¬¦</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>å‰ç«¯ç®—æ³•</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/algorithm/quick-sort.html" class="sidebar-link">å¿«æ’</a></li><li><a href="/blog/algorithm/dfs-bfs.html" class="sidebar-link">æ ‘çš„æ·±åº¦éå†å’Œå¹¿åº¦éå†</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>æµè§ˆå™¨</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/browser/çº¿ç¨‹å’Œè¿›ç¨‹.html" class="sidebar-link">ç†è§£è¿›ç¨‹ã€çº¿ç¨‹</a></li><li><a href="/blog/browser/åŒæ­¥å¼‚æ­¥.html" class="sidebar-link">åŒæ­¥ä¸å¼‚æ­¥</a></li><li><a href="/blog/browser/Http.html" class="sidebar-link">ç½‘ç»œå®‰å…¨</a></li><li><a href="/blog/browser/è·¨åŸŸ.html" class="active sidebar-link">å‰ç«¯è·¨åŸŸçš„é‚£äº›äº‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/browser/è·¨åŸŸ.html#ä»€ä¹ˆæ˜¯åŒæºç­–ç•¥" class="sidebar-link">ä»€ä¹ˆæ˜¯åŒæºç­–ç•¥</a></li><li class="sidebar-sub-header"><a href="/blog/browser/è·¨åŸŸ.html#cors-è·¨åŸŸ" class="sidebar-link">CORS è·¨åŸŸ</a></li><li class="sidebar-sub-header"><a href="/blog/browser/è·¨åŸŸ.html#jsonp-è·¨åŸŸ" class="sidebar-link">JSONP è·¨åŸŸ</a></li><li class="sidebar-sub-header"><a href="/blog/browser/è·¨åŸŸ.html#iframe-è·¨åŸŸ" class="sidebar-link">IFRAME è·¨åŸŸ</a></li></ul></li><li><a href="/blog/browser/V8.html" class="sidebar-link">V8åƒåœ¾å›æ”¶</a></li><li><a href="/blog/browser/EventLoop.html" class="sidebar-link">æ—¶é—´å¾ªç¯</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>å‰ç«¯å·¥ç¨‹åŒ–</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/webpack/å·¥ç¨‹åŒ–å·¥å…·.html" class="sidebar-link">å·¥ç¨‹åŒ–å·¥å…·</a></li><li><a href="/blog/webpack/æ¨¡å—åŒ–.html" class="sidebar-link">æ¨¡å—åŒ–</a></li><li><a href="/blog/webpack/webpackåŸºç¡€.html" class="sidebar-link">webpackåŸºç¡€</a></li><li><a href="/blog/webpack/åŸºç¡€é…ç½®.html" class="sidebar-link">webpackåŸºç¡€é…ç½®</a></li><li><a href="/blog/webpack/entryå»¶ä¼¸.html" class="sidebar-link">webpack å…¥å£</a></li><li><a href="/blog/webpack/webpackæ€§èƒ½ä¼˜åŒ–.html" class="sidebar-link">webpackæ€§èƒ½ä¼˜åŒ–</a></li><li><a href="/blog/webpack/webpackæ‰“åŒ…æµç¨‹.html" class="sidebar-link">webpackæ‰“åŒ…æµç¨‹</a></li><li><a href="/blog/webpack/webpackæ ¸å¿ƒåŸç†.html" class="sidebar-link">webpackæ ¸å¿ƒåŸç†</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="å‰ç«¯è·¨åŸŸçš„é‚£äº›äº‹"><a href="#å‰ç«¯è·¨åŸŸçš„é‚£äº›äº‹" class="header-anchor">#</a> å‰ç«¯è·¨åŸŸçš„é‚£äº›äº‹</h1> <h2 id="ä»€ä¹ˆæ˜¯åŒæºç­–ç•¥"><a href="#ä»€ä¹ˆæ˜¯åŒæºç­–ç•¥" class="header-anchor">#</a> ä»€ä¹ˆæ˜¯åŒæºç­–ç•¥</h2> <p>åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ï¼Œç»å¸¸ç¢°åˆ°ä¸€äº›è·¨åŸŸçš„é—®é¢˜ã€‚</p> <p>ä¾‹å¦‚<code>www.a.com</code>æƒ³è¦è·å–åˆ°<code>www.b.com</code>çš„æ¥å£æˆ–è€…æ•°æ®ã€‚å°±ä¼šå› ä¸ºåŒæºç­–ç•¥çš„åŸå› è€Œæ— æ³•è·å–åˆ°ã€‚</p> <blockquote><p>åŒæºç­–ç•¥ same-orgin policy
<strong>ä¸åŒåŸŸ</strong>çš„å®¢æˆ·ç«¯è„šæœ¬åœ¨æ²¡æœ‰æ˜ç¡®<strong>æˆæƒ</strong>çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½è¯»å†™å¯¹æ–¹çš„èµ„æºã€‚</p></blockquote> <h3 id="ä¸¾ä¾‹"><a href="#ä¸¾ä¾‹" class="header-anchor">#</a> ä¸¾ä¾‹</h3> <p>http://a.taobao.com</p> <table><thead><tr><th style="text-align:left;">åœ°å€</th> <th style="text-align:right;">æ˜¯å¦å¯ä»¥è¯·æ±‚</th></tr></thead> <tbody><tr><td style="text-align:left;">https://a.taobao.com</td> <td style="text-align:right;">ä¸å¯ä»¥-åè®®ä¸åŒ</td></tr> <tr><td style="text-align:left;">http://www.taobao.com</td> <td style="text-align:right;">ä¸å¯ä»¥-å­åŸŸä¸åŒ</td></tr> <tr><td style="text-align:left;">http://taobao.com</td> <td style="text-align:right;">ä¸å¯ä»¥-å­åŸŸä¸åŒ</td></tr> <tr><td style="text-align:left;">http://a.taobao.com:8080</td> <td style="text-align:right;">ä¸å¯ä»¥-ç«¯å£ä¸åŒ</td></tr> <tr><td style="text-align:left;">http://a.taobao.com/music/</td> <td style="text-align:right;">å¯ä»¥-åŒåŸŸ</td></tr></tbody></table> <h2 id="cors-è·¨åŸŸ"><a href="#cors-è·¨åŸŸ" class="header-anchor">#</a> CORS è·¨åŸŸ</h2> <p>CORS æ˜¯ä¸€ç§è·¨åŸŸçš„è§£å†³æ–¹æ¡ˆï¼Œå…¶åŸç†å°±æ˜¯å‰å°å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œè€ŒæœåŠ¡å™¨å°±è¿”å›ä¸€ä¸ªè¯·æ±‚å¤´æˆæƒè®¿é—®ã€‚</p> <p><img src="/img/cros.jpg" alt="è¯·æ±‚ç¤ºä¾‹"></p> <ul><li>å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªè·¨åŸŸçš„æ¥å£(<strong>é»˜è®¤å¸¦æœ‰ Origin è¯·æ±‚å¤´</strong>)</li> <li>æœåŠ¡ç«¯æ”¶åˆ°åè®¾ç½®ä¸€ä¸ªå“åº”å¤´å¹¶è¿”å›(<strong>Access-Control-Allow-Origin</strong>)<strong>æˆæƒ</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// åå°koaè„šæœ¬</span>
<span class="token keyword">const</span> koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-bodyparser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//ä½¿ç”¨bodyParser</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> ctx<span class="token punctuation">.</span>url<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>origin <span class="token operator">&amp;&amp;</span> ctx<span class="token punctuation">.</span>query<span class="token punctuation">.</span>cors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//è®¾ç½®è¯·æ±‚å¤´</span>
    ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-origin&quot;</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token punctuation">{</span>
    code<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æœåŠ¡å™¨å†²èµ·æ¥äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>åå°åœ¨<code>node</code> 3000 çš„ç«¯å£è¿è¡Œï¼Œå‰å°åœ¨<code>http-server</code> 3001 ç«¯å£è¿è¡Œ</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//å‰å°è¯·æ±‚</span>
<span class="token keyword">var</span> <span class="token function-variable function">$</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> btn <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;button1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> btn2 <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;button2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> cors</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">,</span> xhr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://127.0.0.1:3000/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cors<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>response<span class="token punctuation">.</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
btn2<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>response<span class="token punctuation">.</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;?cors=1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/img/crostest.gif" alt=""></p> <ul><li>CORS ä¼˜ç‚¹åœ¨äºæ–¹ä¾¿ç®€æ´ï¼Œåªéœ€è¦æœåŠ¡ç«¯è®¾ç½®å“åº”å¤´å°±å¥½äº†ã€‚</li> <li>ç¼ºç‚¹åœ¨ä¸ä¸€äº› IE ä¸å…¼å®¹ å…·ä½“å¯ä»¥çœ‹ ğŸ‘‰ <a href="https://caniuse.com/#search=CORS" target="_blank" rel="noopener noreferrer">CORS å…¼å®¹æ€§<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="jsonp-è·¨åŸŸ"><a href="#jsonp-è·¨åŸŸ" class="header-anchor">#</a> JSONP è·¨åŸŸ</h2> <p>åŸç†</p> <ul><li>é€šè¿‡ <code>script</code>è¿›è¡Œè¯·æ±‚é€šè¿‡ src è¯·æ±‚</li> <li>åˆ›å»ºä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œç„¶ååœ¨è¿œç¨‹æœåŠ¡ä¸Šè°ƒç”¨è¿™ä¸ªå‡½æ•°å¹¶ä¸”å°† JSON æ•°æ®å½¢å¼ä½œä¸ºå‚æ•°ä¼ é€’</li> <li>å°† JSON æ•°æ®å¡«å……è¿›å›è°ƒå‡½æ•°</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//koa</span>
<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-bodyparser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ä½¿ç”¨bodyParser</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> ctx<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;/getData&quot;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ¥å£åç§°</span>
    ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/x-javascript&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token punctuation">{</span>
      code<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token string">&quot;æˆ‘æ˜¯ä¸€ä¸ªjsonPè·¨åŸŸçš„æ•°æ®ï¼&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ctx<span class="token punctuation">.</span>query<span class="token punctuation">.</span>callback <span class="token operator">||</span> <span class="token string">&quot;jsonp&quot;</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&quot;404&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æœåŠ¡å¯åŠ¨ï¼Œæ‰“å¼€ http://127.0.0.1:3000/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>åå°åœ¨<code>node</code> 3000 çš„ç«¯å£è¿è¡Œï¼Œå‰å°åœ¨<code>http-server</code> 8081 ç«¯å£è¿è¡Œ</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * è‡ªåŠ¨å‘é€ jsonp
 * @param {String} url
 * @param {Obj} data
 * @param {Function} callback
 */</span>
<span class="token keyword">function</span> <span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> funcName <span class="token operator">=</span> <span class="token function">getFunctionName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  data <span class="token operator">=</span> data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  data<span class="token punctuation">.</span>callback <span class="token operator">=</span> funcName<span class="token punctuation">;</span>
  url <span class="token operator">=</span> <span class="token function">parseUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token function">serialize</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  window<span class="token punctuation">[</span>funcName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è¿™é‡Œå¯ä»¥çœ‹æƒ…å†µå¤„ç†ï¼Œæ¯”å¦‚å¦‚æœæ˜¯ jsonp æˆ‘ä»¬å¯ä»¥ parse ä¸€ä¸‹</span>
    <span class="token comment">// data = JSON.parse(response)</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">createScript</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * åºåˆ—åŒ–å‚æ•°
 * jsonp ä¸­å‚æ•°åªèƒ½æ˜¯ GET æ–¹å¼ä¼ é€’
 * @param {Obj} data
 */</span>
<span class="token keyword">function</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ret<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> ret<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * å¤„ç† URL ï¼ŒæŠŠå‚æ•°æ‹¼ä¸Šæ¥
 * @param {String} url
 * @param {String} param
 */</span>
<span class="token keyword">function</span> <span class="token function">parseUrl</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> url <span class="token operator">+</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;?&quot;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token string">&quot;?&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> param<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * å¿…é¡»è¦æœ‰ä¸€ä¸ªå…¨å±€å‡½æ•°ï¼Œè€Œä¸”ä¸èƒ½é‡å
 */</span>
<span class="token keyword">function</span> <span class="token function">getFunctionName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">&quot;jsonp_&quot;</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * åˆ›å»º script æ ‡ç­¾å¹¶æ’åˆ° body ä¸­
 * @param {String} url
 */</span>
<span class="token keyword">function</span> <span class="token function">createScript</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> doc <span class="token operator">=</span> document<span class="token punctuation">;</span>
  <span class="token keyword">var</span> script <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>
  doc<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//è°ƒç”¨</span>
<span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:3000/getData&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/img/jsonptest.gif" alt="jsonPå®ç°æ•ˆæœ"></p> <blockquote><p>è¿™æ˜¯ä¸€ä¸ªç®€å•ç‰ˆçš„<code>jsonP</code>çš„å®ç°ï¼Œé¢è¯•ä¸­ä¹Ÿä¼šå¸¸å¸¸è¢«é—®åˆ°ï¼Œå¹¶ä¸”æ‰‹æ’¸ä¸€ä¸ª<code>jsonP</code></p></blockquote> <blockquote><p>å…·ä½“çš„ä¸€ä¸ªæ–¹æ³•å®ç°æ¨èä¸€ä¸ª github ä¸Šé¢çš„ä¸€ä¸ªåº“ ğŸ‘‰ <a href="https://github.com/webmodules/jsonp/blob/master/index.js" target="_blank" rel="noopener noreferrer">å®ç° jsonP<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="iframe-è·¨åŸŸ"><a href="#iframe-è·¨åŸŸ" class="header-anchor">#</a> IFRAME è·¨åŸŸ</h2> <p>åŸç†</p> <ul><li>å€ŸåŠ© iframe æ ‡ç­¾è¿›è¡Œè·¨åŸŸ</li> <li>å°†è·å–åˆ°çš„æ•°æ®æŒ‚è½½åˆ° window.name</li></ul> <p>æˆ‘ä»¬ä»¥ä¸‰ä¸ªé¡µé¢ä¸ºä¾‹å’Œä¸€ä¸ª json ä¸ºä¾‹</p> <ul><li>a.html -&gt; åœ¨ç«¯å£ 3001 è¿è¡Œ</li> <li>b.html -&gt; åœ¨ç«¯å£ 3002 è¿è¡Œ</li> <li>c.html</li> <li>data.json</li> <li>c å»å»æ‰ç”¨çˆ¶çº§çš„æ–¹æ³•ï¼Œå¹¶ä¼ é€’è·å–åˆ°çš„æ•°æ®ã€‚</li></ul> <p>å¤§æ¦‚çš„äº¤äº’å›¾ä¸ºè¿™æ · ğŸ‘‡
<img src="/img/iframe.jpg" alt="äº¤äº’å›¾"></p> <p>a ä¸ºè¯·æ±‚æ•°æ®</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--a.html--&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>æˆ‘æ˜¯Aé¡µé¢<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token punctuation">,</span> xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://127.0.0.1:3002/data.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>b ä¸ºå¤„ç†æ•°æ®</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--b.html--&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>å¤„ç†æ•°æ®<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          window<span class="token punctuation">.</span>name <span class="token operator">=</span> xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
          location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;http://127.0.0.1:3001/c.html&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token punctuation">,</span> xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;data.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>c ä¸ºæ›´æ–°æ•°æ®</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>ä¼ é€’æ•°æ®<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      parent<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>data æ•°æ®</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;æˆ‘æ˜¯ä¸€æ¡è·¨åŸŸæ•°æ®&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>å½“æˆ‘ä»¬è°ƒç”¨ a.html ç¬¬ä¸€ä¸ª AJAX æ–¹æ³•çš„æ—¶å€™ï¼Œæ¯«æ— ç–‘é—®è‚¯å®šæ˜¯è·¨åŸŸçš„ï¼Œå› ä¸ºç«¯å£ä¸ä¸€æ ·</p> <blockquote><p>Access to XMLHttpRequest at 'http://127.0.0.1:3002/data.json' from origin 'http://127.0.0.1:3001' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.</p></blockquote> <p><img src="/img/error.jpg" alt="ajax-error"></p> <p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ A çš„ä»£ç </p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>æˆ‘æ˜¯Aé¡µé¢<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://127.0.0.1:3002/b.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">frameborder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;ul&gt;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        html<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;li&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        html<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/ul&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>åœ¨æ”¹å˜äº†é€»è¾‘æ—¶</p> <ul><li><code>a.html</code> åµŒå¥—äº†ä¸€ä¸ªä¸æ¥å£ä¸€æ ·ç«¯å£çš„ç½‘é¡µ</li> <li><code>b.html</code> é€šè¿‡åŒç«¯å£çš„æ–¹å¼è¯·æ±‚åˆ°äº†æƒ³ç”¨ç«¯å£çš„æ•°æ®ï¼Œå¹¶ä¸”æŒ‚è½½åˆ°äº†å…¨å±€çš„<code>window.name</code>ä¸Šï¼Œå¹¶ä¸”è·³è½¬åˆ°<code>c.html</code></li> <li><code>c.html</code> é€šè¿‡<code>parent</code>è°ƒç”¨<code>a.html</code>çš„<code>update</code>çš„æ–¹æ³•å¹¶æŠŠ<code>window.name</code>å€¼ä¸€åŒä¼ é€’</li></ul> <p>æ­¤æ—¶æˆ‘ä»¬å°±å¤§åŠŸå‘Šæˆå•¦,é¡µé¢æ˜¾ç¤ºå‡º<code>data.json</code>çš„æ•°æ®</p> <p><img src="/img/iframetest.jpg" alt=""></p> <hr></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/blog/browser/Http.html" class="prev">
        ç½‘ç»œå®‰å…¨
      </a></span> <span class="next"><a href="/blog/browser/V8.html">
        V8åƒåœ¾å›æ”¶
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.fa555702.js" defer></script><script src="/assets/js/2.ddebb9ce.js" defer></script><script src="/assets/js/17.075b656b.js" defer></script>
  </body>
</html>
