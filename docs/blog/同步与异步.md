# 同步和异步

**从一道面试题入手**
```js
for(var i = 0; i < 10; i++){
    console.log(i) //0-9
}
for(var i = 0; i < 10; i++){
    setTimeout(()=>{
        console.log(i) //10个10
    })
}

```
这里有可能有一些小伙伴就会有疑惑了 为什么不是0到9而是10个10，让我们一起探索一下吧。

## JS单线程任务
上面的代码中我们可以看出，第一个代码片段是同步任务，第二个代码段setTimeout属于异步的任务。

**同步** 调用之后得到结果，再干别的任务
**异步** 调用之后不看结果先继续别的任务

### 单线程JS怎么实现异步？
首先要先了解进程和线程，具体可以看我的 [理解进程、线程](./理解进程、线程.md)

**阅读完进程、和线程，我们发现浏览器是一个多进程的架构，而js就是通过`浏览器内核多线程`实现异步**

![浏览器线程](/img/浏览器线程.jpg)


## 定时器
- 调用webApi
- 定时器线程计数2秒钟
- 事件触发线程将定时器事件放入任务队列
- 主线程通过EventLoop遍历任务队列
![计时器](/img/计时器.png)

```js
console.log(1)
setTimeout(()=>{
    console.log(2)
},2000)
console.log(3)

** 从刚刚说到的执行图来看 **
1. 同步任务先执行，所以输出1
2. 这是一个定时器，定时器的计数为2秒，将定时器放入到任务队列中
3. 执同步任务3，所以输出三
4. 在同步任务执行完之后，整个执行栈为空，现在任务队列处于一个轮询的状态，
   在2秒之后事件触发线程往任务队列添加任务之后，开始执行计时器是所以输出2

所以完整的是输出是 1、3、2
```
![任务队列](/img/任务队列.png)

### 小结
**所以我们回过头不难发现我们第二道题目为什么输出的是10个10了，我们分析一下:**
```js
for(var i = 0; i < 10; i++){
    setTimeout(()=>{
        console.log(i) //10个10
    })
}

 for循环是同步任务，定时器是异步任务
 1. for循环开始第一次循环，触发了计时器，将定时器放入到任务队列中
 2. 此时如果想触发定时器，那么就要将for循环全部执行结束，所以此时的 i就等于 10
 3. 在任务整个执行栈为空的时候，任务队列轮询状态，触发线程往任务队列添加任务之后，
    开始执行计时器是所以输出10
```


### 定时器的应用场景
可以看看我之前写的文章  [JavaScript 中的防抖和节流](./JavaScript中的防抖和节流.md)
